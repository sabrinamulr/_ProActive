@page "/projekt/{Id:int}"
@using Microsoft.AspNetCore.Authorization
@using ProActive2508.Models.Entity.Anja
@attribute [Authorize]
@rendermode InteractiveServer

@if (isLoading)
{
    <p>Lade…</p>
}
else if (project is null)
{
    <div class="alert alert-warning">Projekt nicht gefunden.</div>
}
else
{
    <div class="card">
        <div class="card-body">
            <h4 class="card-title">@($"Projekt #{project.Id}")</h4>
            <p class="card-text">@project.Projektbeschreibung</p>

            <dl class="row">
                <dt class="col-sm-3">Projektleiter</dt>
                <dd class="col-sm-9">@(_userLookup.TryGetValue(project.ProjektleiterId, out var pl) ? pl : $"Id:{project.ProjektleiterId}")</dd>

                <dt class="col-sm-3">Auftraggeber</dt>
                <dd class="col-sm-9">@(_userLookup.TryGetValue(project.AuftraggeberId, out var ag) ? ag : $"Id:{project.AuftraggeberId}")</dd>

                <dt class="col-sm-3">Status</dt>
                <dd class="col-sm-9">@project.Status</dd>

                <dt class="col-sm-3">Phase</dt>
                <dd class="col-sm-9">@project.Phase</dd>
            </dl>

            @if (CanEdit)
            {
                <button class="btn btn-outline-secondary" @onclick="EnableEdit">Bearbeiten</button>
            }
        </div>
    </div>

    @if (isEditing)
    {
        <div class="mt-3">
            <EditForm Model="editModel" OnValidSubmit="SaveAsync">
                <DataAnnotationsValidator />
                <div class="mb-3">
                    <label class="form-label">Beschreibung</label>
                    <InputTextArea class="form-control" @bind-Value="editModel.Projektbeschreibung" rows="4" />
                </div>
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">Speichern</button>
                    <button type="button" class="btn btn-secondary" @onclick="CancelEdit">Abbrechen</button>
                </div>
            </EditForm>
        </div>
    }
}